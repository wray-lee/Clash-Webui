import{r as g,R as W,k as O,c as C,W as xe,j as o,b as c,B as b,i as f,X as ge,Y as be,Z as ne,$ as re,e as k,a0 as we,F as T,a1 as Ce,a2 as oe,a3 as H,y as D,a4 as ke,a5 as se,a6 as L,a7 as ae,a8 as q,a9 as U,aa as Pe,ab as Se,u as z,ac as Ne,ad as Oe,ae as $e,h as le,C as ie,E as Z,af as Ae,m as G,d as Le,ag as Te,ah as De,ai as Be,aj as Ie,ak as Re}from"./index-90d9ad66.js";import{C as Fe}from"./chevron-down-fa8777df.js";import{F as je,p as Ee,A as Me,I as He}from"./Fab-5562a184.js";import{R as qe,T as Ue}from"./TextFitler-3875cd20.js";import{f as ze}from"./index-84fa0cb3.js";import{R as Ke}from"./rotate-cw-e54bba7f.js";import{S as Ve}from"./Select-85e5e596.js";import"./debounce-c1ba2006.js";function M(){return M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},M.apply(this,arguments)}function We(e,t){if(e==null)return{};var n=Ze(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Ze(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}var K=g.forwardRef(function(e,t){var n=e.color,r=n===void 0?"currentColor":n,s=e.size,a=s===void 0?24:s,l=We(e,["color","size"]);return W.createElement("svg",M({ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},l),W.createElement("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"}))});K.propTypes={color:O.string,size:O.oneOfType([O.string,O.number])};K.displayName="Zap";const Y=K;function ce(e){const t=e.size||24,n=C({[xe.animate]:e.animate});return o("svg",{className:n,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const Ge="_FlexCenter_1380a_1",Ye={FlexCenter:Ge};function Xe({children:e}){return o("div",{className:Ye.FlexCenter,children:e})}const{useRef:X,useEffect:Je}=f;function Qe({onClickPrimaryButton:e,onClickSecondaryButton:t}){const n=X(null),r=X(null);return Je(()=>{n.current.focus()},[]),c("div",{onKeyDown:a=>{a.code==="ArrowRight"?r.current.focus():a.code==="ArrowLeft"&&n.current.focus()},children:[o("h2",{children:"Close Connections?"}),o("p",{children:'Click "Yes" to close those connections that are still using the old selected proxy in this group'}),o("div",{style:{height:30}}),c(Xe,{children:[o(b,{onClick:e,ref:n,children:"Yes"}),o("div",{style:{width:20}}),o(b,{onClick:t,ref:r,children:"No"})]})]})}const et="_header_1y9js_1",tt="_arrow_1y9js_8",nt="_isOpen_1y9js_13",rt="_btn_1y9js_20",ot="_qty_1y9js_25",P={header:et,arrow:tt,isOpen:nt,btn:rt,qty:ot};function ue({name:e,type:t,toggle:n,isOpen:r,qty:s}){const a=g.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&n()},[n]);return c("div",{className:P.header,onClick:n,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[o("div",{children:o(ge,{name:e,type:t})}),typeof s=="number"?o("span",{className:P.qty,children:s}):null,o(b,{kind:"minimal",onClick:n,className:P.btn,title:"Toggle collapsible section",children:o("span",{className:C(P.arrow,{[P.isOpen]:r}),children:o(Fe,{size:20})})})]})}const{useMemo:st}=f;function at(e,t){return e.filter(n=>{const r=t[n];return r===void 0?!0:r.number!==0})}const $=(e,t)=>{if(e&&typeof e.number=="number"&&e.number>0)return e.number;const n=t&&t.type;return n&&re.indexOf(n)>-1?-1:999999},lt={Natural:e=>e,LatencyAsc:(e,t,n)=>e.sort((r,s)=>{const a=$(t[r],n&&n[r]),l=$(t[s],n&&n[s]);return a-l}),LatencyDesc:(e,t,n)=>e.sort((r,s)=>{const a=$(t[r],n&&n[r]);return $(t[s],n&&n[s])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,n)=>t>n?-1:t<n?1:0)};function it(e,t){const n=t.toLowerCase().split(" ").map(r=>r.trim()).filter(r=>!!r);return n.length===0?e:e.filter(r=>{let s=0;for(;s<n.length;s++){const a=n[s];if(r.toLowerCase().indexOf(a)>-1)return!0}return!1})}function ct(e,t,n,r,s,a){let l=[...e];return n&&(l=at(e,t)),typeof r=="string"&&r!==""&&(l=it(l,r)),lt[s](l,t,a)}function de(e,t,n,r,s){const[a]=be(ne);return st(()=>ct(e,t,n,a,r,s),[e,t,n,a,r,s])}const ut="_header_5pmv2_1",dt="_groupHead_5pmv2_5",pt="_action_5pmv2_11",R={header:ut,groupHead:dt,action:pt},ht="_proxy_16gsi_1",yt="_now_16gsi_27",ft="_error_16gsi_31",mt="_selectable_16gsi_34",_t="_proxyType_16gsi_42",vt="_row_16gsi_53",xt="_proxyName_16gsi_59",gt="_proxySmall_16gsi_68",m={proxy:ht,now:yt,error:ft,selectable:mt,proxyType:_t,row:vt,proxyName:xt,proxySmall:gt},bt="_proxyLatency_pw0sa_1",wt={proxyLatency:bt};function Ct({latency:e,color:t}){let n=" ";if(e)switch(e.kind){case"Error":case"Testing":n="- ms";break;case"Result":n=(e.number!==0?e.number:"-")+" ms";break}return o("span",{className:wt.proxyLatency,style:{color:t},children:n})}const{useMemo:N}=f,w={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function pe(e){if(!e||e.kind!=="Result")return w.na;const t=e.number;return t===0?w.na:t<200?w.good:t<400?w.normal:typeof t=="number"?w.bad:w.na}function kt(e,t){return re.indexOf(t)>-1?{border:"1px dotted #777"}:{background:pe(e)}}function Pt({now:e,name:t,proxy:n,latency:r,isSelectable:s,onClick:a}){const l=N(()=>kt(r,n.type),[r,n]),i=N(()=>{let d=t;return r&&r.kind==="Result"&&typeof r.number=="number"&&(d+=" "+r.number+" ms"),d},[t,r]),u=g.useCallback(()=>{s&&a&&a(t)},[t,a,s]),p=N(()=>C(m.proxySmall,{[m.now]:e,[m.selectable]:s}),[s,e]),h=g.useCallback(d=>{d.key==="Enter"&&u()},[u]);return o("div",{title:i,className:p,style:l,onClick:u,onKeyDown:h,role:s?"menuitem":""})}function St(e){return e==="Shadowsocks"?"SS":e}const Nt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function Ot({children:e,label:t,"aria-label":n}){const[r,s]=we();return c(T,{children:[g.cloneElement(e,r),o(Ce,{...s,label:t,"aria-label":n,position:Nt})]})}function $t({now:e,name:t,proxy:n,latency:r,isSelectable:s,onClick:a}){const l=N(()=>pe(r),[r]),i=g.useCallback(()=>{s&&a&&a(t)},[t,a,s]),u=g.useCallback(h=>{h.key==="Enter"&&i()},[i]),p=N(()=>C(m.proxy,{[m.now]:e,[m.selectable]:s}),[s,e]);return c("div",{tabIndex:0,className:p,onClick:i,onKeyDown:u,role:s?"menuitem":"",children:[o("div",{className:m.proxyName,children:o(Ot,{label:t,"aria-label":"proxy name: "+t,children:o("span",{children:t})})}),c("div",{className:m.row,children:[o("span",{className:m.proxyType,style:{opacity:e?.6:.2},children:St(n.type)}),o(Ct,{latency:r,color:l})]})]})}const he=(e,{name:t})=>{const n=oe(e),r=H(e);return{proxy:n[t]||{name:t,type:"Unknown",history:[]},latency:r[t]}},At=k(he)($t),Lt=k(he)(Pt),Tt="_list_1oy7w_1",Dt="_listSummaryView_1oy7w_8",ye={list:Tt,listSummaryView:Dt};function fe({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){const s=e;return o("div",{className:ye.list,children:s.map(a=>o(At,{onClick:r,isSelectable:n,name:a,now:a===t},a))})}function me({all:e,now:t,isSelectable:n,itemOnTapCallback:r}){return o("div",{className:ye.listSummaryView,children:e.map(s=>o(Lt,{onClick:r,isSelectable:n,name:s,now:s===t},s))})}const{createElement:Bt,useCallback:F,useMemo:It}=f;function Rt({name:e,all:t,delay:n,hideUnavailableProxies:r,proxySortBy:s,proxies:a,type:l,now:i,isOpen:u,apiConfig:p,dispatch:h}){const d=de(t,n,r,s,a),v=It(()=>l==="Selector",[l]),{app:{updateCollapsibleIsOpen:x},proxies:{requestDelayForProxies:y}}=D(),B=F(()=>{x("proxyGroup",e,!u)},[u,x,e]),I=F(V=>{v&&h(ke(p,e,V))},[p,h,e,v]),_=se(!1),ve=F(async()=>{if(!_.value){_.set(!0);try{await y(p,d)}catch{}_.set(!1)}},[d,p,y,_]);return c("div",{className:R.group,children:[c("div",{className:R.groupHead,children:[o(ue,{name:e,type:l,toggle:B,qty:d.length,isOpen:u}),o("div",{className:R.action,children:o(L,{label:"Test latency",children:o(b,{kind:"circular",onClick:ve,children:o(ce,{animate:_.value,size:16})})})})]}),Bt(u?fe:me,{all:d,now:i,isSelectable:v,itemOnTapCallback:I})]})}const Ft=k((e,{name:t,delay:n})=>{const r=oe(e),s=ae(e),a=q(e),l=U(e),i=r[t],{all:u,type:p,now:h}=i;return{all:u,delay:n,hideUnavailableProxies:l,proxySortBy:a,proxies:r,type:p,now:h,isOpen:s[`proxyGroup:${t}`]}})(Rt),{useCallback:_e,useState:jt}=f;function Et({dispatch:e,apiConfig:t,name:n}){return _e(()=>e(Pe(t,n)),[t,e,n])}function Mt({dispatch:e,apiConfig:t,names:n}){const[r,s]=jt(!1);return[_e(async()=>{if(!r){s(!0);try{await e(Se(t,n))}catch{}s(!1)}},[t,e,n,r]),r]}const{useState:Ht,useCallback:qt}=f;function Ut({isLoading:e}){return e?o(He,{children:o(Y,{width:16,height:16})}):o(Y,{width:16,height:16})}function zt({dispatch:e,apiConfig:t}){const[n,r]=Ht(!1);return[qt(()=>{n||(r(!0),e(Ne(t)).then(()=>r(!1),()=>r(!1)))},[t,e,n]),n]}function Kt({dispatch:e,apiConfig:t,proxyProviders:n}){const{t:r}=z(),[s,a]=zt({dispatch:e,apiConfig:t}),[l,i]=Mt({apiConfig:t,dispatch:e,names:n.map(u=>u.name)});return o(je,{icon:o(Ut,{isLoading:a}),onClick:s,text:r("Test Latency"),style:Ee,children:n.length>0?o(Me,{text:r("update_all_proxy_provider"),onClick:l,children:o(qe,{isRotating:i})}):null})}const Vt="_updatedAt_919yi_1",Wt="_main_919yi_8",Zt="_head_919yi_17",Gt="_action_919yi_23",Yt="_refresh_919yi_31",S={updatedAt:Vt,main:Wt,head:Zt,action:Gt,refresh:Yt},{useCallback:J}=f;function Xt({name:e,proxies:t,delay:n,hideUnavailableProxies:r,proxySortBy:s,vehicleType:a,updatedAt:l,isOpen:i,dispatch:u,apiConfig:p}){const h=de(t,n,r,s),d=se(!1),v=Et({dispatch:u,apiConfig:p,name:e}),x=J(()=>{if(d.value)return;d.set(!0);const _=()=>d.set(!1);u(Oe(p,e)).then(_,_)},[p,u,e,d]),{app:{updateCollapsibleIsOpen:y}}=D(),B=J(()=>{y("proxyProvider",e,!i)},[i,y,e]),I=ze(new Date(l),new Date);return c("div",{className:S.main,children:[c("div",{className:S.head,children:[o(ue,{name:e,toggle:B,type:a,isOpen:i,qty:h.length}),c("div",{className:S.action,children:[o(L,{label:"Update",children:o(b,{kind:"circular",onClick:v,children:o(en,{})})}),o(L,{label:"Health Check",children:o(b,{kind:"circular",onClick:x,children:o(ce,{animate:d.value,size:16})})})]})]}),o("div",{className:S.updatedAt,children:c("small",{children:["Updated ",I," ago"]})}),i?o(fe,{all:h}):o(me,{all:h})]})}const Jt={rest:{scale:1},pressed:{scale:.95}},Qt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function en(){const t=$e.read().motion;return o(t.div,{className:S.refresh,variants:Jt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:o(t.div,{className:"flexCenter",variants:Qt,children:o(Ke,{size:16})})})}const tn=(e,{proxies:t,name:n})=>{const r=U(e),s=H(e),a=ae(e),l=le(e),i=q(e);return{apiConfig:l,proxies:t,delay:s,hideUnavailableProxies:r,proxySortBy:i,isOpen:a[`proxyProvider:${n}`]}},nn=k(tn)(Xt);function rn({items:e}){return e.length===0?null:c(T,{children:[o(ie,{title:"Proxy Provider"}),o("div",{children:e.map(t=>o(nn,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const on="_labeledInput_cmki0_1",j={labeledInput:on},sn=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:Q}=f;function an({appConfig:e}){const{app:{updateAppConfig:t}}=D(),n=Q(a=>{t("proxySortBy",a.target.value)},[t]),r=Q(a=>{t("hideUnavailableProxies",a)},[t]),{t:s}=z();return c(T,{children:[c("div",{className:j.labeledInput,children:[o("span",{children:s("sort_in_grp")}),o("div",{children:o(Ve,{options:sn.map(a=>[a[0],s(a[1])]),selected:e.proxySortBy,onChange:n})})]}),o("hr",{}),c("div",{className:j.labeledInput,children:[o("span",{children:s("hide_unavail_proxies")}),o("div",{children:o(Z,{name:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:r})})]}),c("div",{className:j.labeledInput,children:[o("span",{children:s("auto_close_conns")}),o("div",{children:o(Z,{name:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const ln=e=>{const t=q(e),n=U(e),r=Ae(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:n,autoCloseOldConns:r}}},cn=k(ln)(an),un="_overlay_uuk3b_1",dn="_cnt_uuk3b_5",pn="_afterOpen_uuk3b_16",E={overlay:un,cnt:dn,afterOpen:pn},{useMemo:hn}=f;function ee({isOpen:e,onRequestClose:t,children:n}){const r=hn(()=>({base:C(G.content,E.cnt),afterOpen:E.afterOpen,beforeClose:""}),[]);return o(Le,{isOpen:e,onRequestClose:t,className:r,overlayClassName:C(G.overlay,E.overlay),children:n})}function yn({color:e="currentColor",size:t=24}){return c("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o("path",{d:"M2 6h9M18.5 6H22"}),o("circle",{cx:"16",cy:"6",r:"2"}),o("path",{d:"M22 18h-9M6 18H2"}),o("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const fn="_topBar_16fpp_1",mn="_topBarRight_16fpp_13",_n="_textFilterContainer_16fpp_22",vn="_group_16fpp_29",A={topBar:fn,topBarRight:mn,textFilterContainer:_n,group:vn},{useState:xn,useEffect:gn,useCallback:te,useRef:bn}=f;function wn({dispatch:e,groupNames:t,delay:n,proxyProviders:r,apiConfig:s,showModalClosePrevConns:a}){const l=bn({}),i=te(()=>{l.current.startAt=Date.now(),e(Te(s)).then(()=>{l.current.completeAt=Date.now()}),e(De(s))},[s,e]);gn(()=>{i();const y=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&i()};return window.addEventListener("focus",y,!1),()=>window.removeEventListener("focus",y,!1)},[i]);const[u,p]=xn(!1),h=te(()=>{p(!1)},[]),{proxies:{closeModalClosePrevConns:d,closePrevConnsAndTheModal:v}}=D(),{t:x}=z();return c(T,{children:[o(ee,{isOpen:u,onRequestClose:h,children:o(cn,{})}),c("div",{className:A.topBar,children:[o(ie,{title:x("Proxies")}),c("div",{className:A.topBarRight,children:[o("div",{className:A.textFilterContainer,children:o(Ue,{textAtom:ne})}),o(L,{label:x("settings"),children:o(b,{kind:"minimal",onClick:()=>p(!0),children:o(yn,{size:16})})})]})]}),o("div",{children:t.map(y=>o("div",{className:A.group,children:o(Ft,{name:y,delay:n,apiConfig:s,dispatch:e})},y))}),o(rn,{items:r}),o("div",{style:{height:60}}),o(Kt,{dispatch:e,apiConfig:s,proxyProviders:r}),o(ee,{isOpen:a,onRequestClose:d,children:o(Qe,{onClickPrimaryButton:()=>v(s),onClickSecondaryButton:d})})]})}const Cn=e=>({apiConfig:le(e),groupNames:Be(e),proxyProviders:Ie(e),delay:H(e),showModalClosePrevConns:Re(e)}),Tn=k(Cn)(wn);export{Tn as default};
